"use strict";function Catalog(){function e(){var t=i.sorter.querySelector(".".concat(i.sortActiveClass));s.type=t.getAttribute("data-sort-type"),s.order=t.classList.contains(i.sortOrderDownClass)?"down":"up"}function a(){var e=document.querySelector(i.listSelector),t=document.querySelectorAll(i.itemSelector);Array.prototype.slice.call(t).map(function(t){return e.removeChild(t)}).sort(function(t,e){var a=parseInt(t.querySelector(i.cardSelector).getAttribute("data-".concat(s.type)).replace(/\s/g,"")),n=parseInt(e.querySelector(i.cardSelector).getAttribute("data-".concat(s.type)).replace(/\s/g,""));return a===n?0:n<a?"down"===s.order?-1:1:"down"===s.order?1:-1}).forEach(function(t){e.appendChild(t)})}function t(){i.moreBtn.addEventListener("click",function(t){var e=this;t.preventDefault(),this.classList.add(i.btnLoadClass),fetch("".concat(n.url).concat(n.step,".json")).then(function(t){return t.json()}).then(function(t){n.step+=1,e.classList.remove(i.btnLoadClass),function(t){var e=document.querySelector(i.listSelector),c=localStorage.getItem(i.favKey);c=c?c.split(";"):[];var r=localStorage.getItem(i.unfavKey);r=r?r.split(";"):[],t.map(function(t){var e,a,n,s=document.createElement("div");return s.classList.add("catalog__item","j-catalog__item"),s.innerHTML='\n        <div class="card card--status--'.concat(t.status,'" data-id="').concat(t.id,'" data-price="').concat(t.price,'" data-rooms="').concat(t.rooms,'">\n          <button class="card__fav fav-btn ').concat((n=!1,t.favourite&&-1===r.indexOf("".concat(t.id))&&(n=!0),-1!==c.indexOf("".concat(t.id))&&(n=!0),n?"fav-btn--active":null),'" type="button">\n            <svg class="fav-btn__icon" width="19" height="18">\n              <use href="static/img/icons.svg#i-star"></use>\n            </svg>\n          </button><a class="card__body" href="').concat(t.url,'">\n            <div class="card__labels">').concat((e=t.labels,a="",e&&e.forEach(function(t){a+='<span class="label '.concat(t.discount?"label--discount":null,'">').concat(t.value,"</span>")}),a),'</div>\n            <div class="card__content">\n              <div class="card__img">\n                <div class="card__img-inner" style="background-image: url(').concat(t.back,')"></div>\n              </div>\n              <h4 class="heading card__title">').concat(t.title,'</h4>\n              <ul class="card__params params">\n                <li class="params__item params__item--accent">').concat(t.finish,'</li>\n                <li class="params__item"><span class="params__value">').concat(t.area,' м<sup>2</sup></span><span class="params__label">площадь</span></li>\n                <li class="params__item"><span class="params__value">').concat(t.floor,'</span><span class="params__label">этаж</span></li>\n              </ul>\n              <div class="card__price">').concat(divideNumber(t.price),' руб.</div>\n            </div>\n            <div class="card__status btn"></div></a>\n        </div>\n      '),s}).forEach(function(t){e.appendChild(t)})}(t.result),function(t){t.next?i.moreBtn.innerHTML="Показать еще ".concat(t.total-document.querySelectorAll(i.itemSelector).length):getParent(i.moreBtn).removeChild(i.moreBtn)}(t),a()}).catch(function(){e.classList.remove(i.btnLoadClass)})})}var i={listSelector:".j-catalog__list",itemSelector:".j-catalog__item",cardSelector:".card",sorter:document.querySelector(".j-sorter"),sortItemSelector:".j-sort-item",sortActiveClass:"sort-item--active",sortOrderDownClass:"sort-item--down",sortOrderUpClass:"sort-item--up",moreBtn:document.querySelector(".j-catalog__btn"),btnLoadClass:"btn--loading",favClass:"fav-btn",favActiveClass:"fav-btn--active",favKey:"fav",unfavKey:"unfav"},s={type:"price",order:"down"},n={step:1,url:"static/json/data_"};this.init=function(){document.addEventListener("DOMContentLoaded",function(){e(),a(),document.querySelectorAll(i.sortItemSelector).forEach(function(t){t.addEventListener("click",function(t){t.preventDefault(),this.classList.contains(i.sortActiveClass)?this.classList.contains(i.sortOrderDownClass)?(this.classList.remove(i.sortOrderDownClass),this.classList.add(i.sortOrderUpClass)):(this.classList.add(i.sortOrderDownClass),this.classList.remove(i.sortOrderUpClass)):(i.sorter.querySelector(".".concat(i.sortActiveClass)).classList.remove(i.sortActiveClass),this.classList.add(i.sortActiveClass)),e(),a()})}),t(),function(){var t=document.querySelectorAll(i.cardSelector),a=localStorage.getItem(i.favKey);a=a?a.split(";"):[];var n=localStorage.getItem(i.unfavKey);n=n?n.split(";"):[],Array.prototype.slice.call(t).forEach(function(t){var e=t.querySelector(".".concat(i.favClass));e.classList.contains(i.favActiveClass)?-1!==n.indexOf(t.getAttribute("data-id"))&&e.classList.remove(i.favActiveClass):-1!==a.indexOf(t.getAttribute("data-id"))&&e.classList.add(i.favActiveClass)})}(),document.querySelector(i.listSelector).addEventListener("click",function(t){if(t.target.classList.contains(i.favClass)){var e=t.target,a=getParent(e).getAttribute("data-id"),n=localStorage.getItem(i.favKey);n=n?n.split(";"):[];var s=localStorage.getItem(i.unfavKey);s=s?s.split(";"):[],e.classList.contains(i.favActiveClass)?(-1!==n.indexOf(a)&&n.splice(n.indexOf(a),1),-1===s.indexOf(a)&&s.push(a)):(-1!==s.indexOf(a)&&s.splice(s.indexOf(a),1),-1===n.indexOf(a)&&n.push(a)),n=n.join(";"),s=s.join(";"),localStorage.setItem(i.favKey,n),localStorage.setItem(i.unfavKey,s),e.classList.toggle(i.favActiveClass)}})})}}var catalog=new Catalog;function InputEmail(){function t(t){var e=t.target.value,a=getAncestor(t.target,s.elemClass);if(e&&""!==e.trim()&&0!=e.search(s.pattern)){if(a.classList.add(s.className),!a.querySelector(s.msgClass)){var n=document.createElement("span");n.classList.add(s.msgClass),n.innerHTML=s.error,a.appendChild(n)}}else a.classList.remove(s.className)}var s={elemClass:"j-inp",input:document.querySelector(".j-inp__field"),className:"inp--error",msgClass:"inp__message",error:"Введите корректный email",pattern:/^[a-z0-9_-]+@[a-z0-9-]+\.([a-z]{1,6}\.)?[a-z]{2,6}$/i};this.init=function(){s.input.onblur=t,s.input.oninput=function(t){var e=getAncestor(t.target,s.elemClass);e.classList.contains(s.className)&&(e.classList.remove(s.className),e.removeChild(e.querySelector(".".concat(s.msgClass))))}}}catalog.init();var inpEmail=new InputEmail;function Menu(){var e={elemClass:"j-menu",toggler:document.querySelector(".j-menu__toggler"),className:"menu--opened"};this.init=function(){document.addEventListener("DOMContentLoaded",function(){e.toggler.addEventListener("click",function(t){t.preventDefault(),getAncestor(t.target,e.elemClass).classList.toggle(e.className)}),["resize","orientationchage"].forEach(function(t){window.addEventListener(t,function(){1024<=window.innerWidth&&document.querySelector(".".concat(e.elemClass)).classList.remove(e.className)})})})}}inpEmail.init();var menu=new Menu;function UpBtn(){function e(){0<window.pageYOffset?n.elem.classList.remove(n.className):n.elem.classList.add(n.className)}function t(){n.elem.addEventListener("click",function(t){t.preventDefault(),clearTimeout(a),function t(){var e=window.pageYOffset;return 0<e?(window.scrollTo(0,Math.floor(e/1.5)),a=setTimeout(t,30)):clearTimeout(a),!1}()})}var a=null,n={elem:document.querySelector(".j-up-btn"),className:"up-btn--hidden",scrollSpeed:600};this.init=function(){document.addEventListener("DOMContentLoaded",function(){e(),window.onscroll=e,["resize","orientationchage"].forEach(function(t){window.addEventListener(t,e)}),t()})}}menu.init();var upBtn=new UpBtn;upBtn.init();var getParent=function(t){return t.parentElement||t.parentNode};function getAncestor(t,e){for(var a=t;!a.classList.contains(e)&&(a=a.parentElement););return a}function getSiblings(t){for(var e=[],a=t;a.previousSibling;)1===(a=a.previousSibling).nodeType&&e.push(a);for(a=t;a.nextSibling;)1===(a=a.nextSibling).nodeType&&e.push(a);return e}function divideNumber(t,e){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,e||" ")}